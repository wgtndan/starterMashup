getAuthAndRedirect()
var qlikTicket;
function getAuthAndRedirect() {
    $.ajax({
        url: window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + "/getTicket",
        dataType: "json"
    }).done(function (data) {
        qlikTicket = data.Ticket;
        $(qlikLogin).attr('src', (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix +'resources/img/core/dark_noise_16x16.png?qlikTicket=' + data.Ticket);
        $(qlikLogin).bind('load',loadScripts);
    });
}


function loadScripts(){
    //This now hides the dark_noise image
    $(qlikLogin).hide();

    //Now that we are authenticated we can call RequireJS from Qlik, and pass through the main.js file as the next JS to call. This will create and populate the visualisations.
    $("head").append("<script data-main=\"/javascripts/main.js\" type='text/javascript' src='"+ (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix + "resources/assets/external/requirejs/require.js'></script>");
    $("head").append("<link href='" + (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix +"resources/autogenerated/qlik-styles.css' rel='stylesheet'>");
}   

function getURLParameter(name) {
  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
}

function defer(method) {
    if (typeof require == 'undefined') {
        method();
    } else {
        setTimeout(function() { defer(method) }, 50);
    }
}